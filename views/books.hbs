{{!-- Citations:
Date: 11/24/24
Adopted from: Used to handle the Javascript to Database calls, but wrote my own database queries in query input section
Source URL:https://waelyasmina.medium.com/a-guide-into-using-handlebars-with-your-express-js-application-22b944443b65

Date: 11/24/24
Based on: Used for formatting of hbs files, and also web page layout.
Source URL:https://github.com/osu-cs340-ecampus/nodejs-starter-app/tree/main --}}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Books</title>

    <script>
    function showEditForm(button) {
        // Retrieve data attributes from the clicked button
        const bookId = button.dataset.bookId;
        const title = button.dataset.title;
        const authorId = button.dataset.authorId;
        const genreId = button.dataset.genreId;
        const price = button.dataset.price;
        const quantity = button.dataset.quantity;

        // Populate the edit form fields
        document.getElementById('edit-book-id').value = bookId;
        document.getElementById('edit-title').value = title;
        document.getElementById('edit-price').value = price;
        document.getElementById('edit-quantity').value = quantity;

        // Set the selected author in the dropdown
        const authorDropdown = document.getElementById('edit-author_id');
        for (let option of authorDropdown.options) {
            if (option.value === authorId) {
                option.selected = true;
                break;
            }
        }

        // Set the selected genre in the dropdown
        const genreDropdown = document.getElementById('edit-genre_id');
        for (let option of genreDropdown.options) {
            if (option.value === genreId) {
                option.selected = true;
                break;
            }
        }

        // Display the edit form
        document.getElementById('edit-form').style.display = 'block';
        document.getElementById('edit-form').scrollIntoView({ behavior: 'smooth' });
    }
</script>




</head>
<body>
    <h1>Books</h1>

    <!-- Books Table -->
    <table border="1">
        <thead>
            <tr>
                <th>Book ID</th>
                <th>Title</th>
                <th>Author</th>
                <th>Genre</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Edit</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody>
            {{#each books}}
            <tr>
                <td>{{this.book_id}}</td>
                <td>{{this.title}}</td>
                <td>{{this.author_name}}</td>
                <td>{{this.genre_title}}</td>
                <td>{{this.price}}</td>
                <td>{{this.quantity}}</td>
                <td>
                    <button 
                        onclick="showEditForm(this)" 
                        data-book-id="{{this.book_id}}" 
                        data-title="{{this.title}}" 
                        data-author-id="{{this.author_id}}" 
                        data-genre-id="{{this.genre_id}}"
                        data-price="{{this.price}}"
                        data-quantity="{{this.quantity}}">
                        Edit
                    </button>
                </td>
                <td>
                    <form method="POST" action="/delete-book">
                        <input type="hidden" name="book_id" value="{{this.book_id}}">
                        <button type="submit" onclick="return confirm('Are you sure you want to delete this book?');">Delete</button>
                    </form>
                </td>
            </tr>
            {{/each}}
        </tbody>
    </table>

    <!-- Edit Book Form -->
    <div id="edit-form" style="display:none;">
        <h2>Edit Book</h2>
        <form method="POST" action="/edit-book">
            <input type="hidden" name="book_id" id="edit-book-id">

            <label for="edit-title">Title:</label>
            <input type="text" name="title" id="edit-title" required>

        <label for="edit-author_id">Author:</label>
    <select name="author_id" id="edit-author_id" required>
    <option value="">--Select Author--</option>
        {{#each authors}}
        <option value="{{this.author_id}}">{{this.name}}</option>
    {{/each}}
    </select>

    <label for="edit-genre_id">Genre:</label>
    <select name="genre_id" id="edit-genre_id" required>
        <option value="">--Select Genre--</option>
        {{#each genres}}
    <option value="{{this.genre_id}}">{{this.title}}</option>
        {{/each}}
    </select>

        </select>
            <label for="edit-price">Price:</label>
            <input type="number" step="0.01" name="price" id="edit-price" required>

            <label for="edit-quantity">Quantity:</label>
            <input type="number" name="quantity" id="edit-quantity" required>

            <button type="submit">Update Book</button>
        </form>
    </div>

    <!-- Add Book Form -->
    <h2>Add Book</h2>
    <form id="add-book-form" method="POST" action="/add-book">
        <label for="add-title">Title:</label>
        <input type="text" name="title" id="add-title" required>

        <label for="add-author_id">Author:</label>
        <select name="author_id" id="add-author_id" required>
            <option value="">--Select Author--</option>
            {{#each authors}}
            <option value="{{this.author_id}}">{{this.name}}</option>
            {{/each}}
        </select>

        <label for="add-genre_id">Genre:</label>
        <select name="genre_id" id="add-genre_id" required>
            <option value="">--Select Genre--</option>
            {{#each genres}}
            <option value="{{this.genre_id}}">{{this.title}}</option>
            {{/each}}
        </select>

        <label for="add-price">Price:</label>
        <input type="number" step="0.01" name="price" id="add-price" required>

        <label for="add-quantity">Quantity:</label>
        <input type="number" name="quantity" id="add-quantity" required>

        <button type="submit">Add Book</button>
    </form>
</body>
</html>
